<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout_admin}"
      xmlns:th="http://www.thymeleaf.org">

<style layout:fragment="css">
</style>

<!-- default_layout_admin.html 에 정의한 main page 부분 -->
<div layout:fragment="content">
    <!--컨텐츠 내용-->
    <div class="admin">
        <div class="pageTitle-wrap">
            <h3 class="title">관리자 관리</h3>
            <ul class="contentMenu">
                <li><a href="adminList.html">HOME</a></li>
                <li><a href="adminList.html">회원관리</a></li>
                <li><a href="adminList.html">관리자 관리</a></li>
            </ul>
        </div>

        <div class="inventList page-tableBox pc768-wrap wait-list">
            <div class="wait-list-2">
                <p>관리자 리스트</p>
                <div class="search-wrap-admin search-wrap-userList">
                    <button class="yellow-btn modal-admin-btn admin-add-btn">관리자 추가</button>
                </div>
            </div>
            <!--        <div class="wait-list-2">
                        <select class="mr10 select-all">
                            <option value="전체">전체</option>
                            <option value="제목">10</option>
                        </select>
                        <div class="search-wrap-admin">
                            <div class="searchBox">
                                <input type="text" placeholder="search">
                            </div>
                        </div>
                    </div>-->
            <table class="page-table1 table-hover adminList-table">
                <colgroup>
                    <col style="width:5%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                </colgroup>

                <thead>
                <tr>
                    <th><input type="checkbox" id="chkAllUsers"></th>
                    <th>등급</th>
                    <th>아이디</th>
                    <th>닉네임</th>
                    <th>관리자명</th>
                    <th>관리자 연락처</th>
                    <th>생성일</th>
                    <th>관리</th>
                </tr>
                </thead>
                <tbody id="managerUsersTbody">
                <!--<tr>
                    <td><input type="checkbox"></td>
                    <td>
                        <select class="mr10" id="sel">
                            <option value="test1">대표관리자</option>
                            <option value="test2">게시판관리자</option>
                            <option value="test3">수입관리자</option>
                        </select>
                    </td>
                    <td>test111@gmail.com</td>
                    <td>관리자</td>
                    <td>김지영</td>
                    <td>010-0000-0000</td>
                    <td>2020-09-09</td>
                    <td class="y-admin-btn-wrap">
                        <button class="comm-btn admin-btn admin-modify-btn">수정</button>
                        <button class="comm-btn admin-btn">삭제</button>
                    </td>
                </tr>
                <tr>
                    <td><input type="checkbox"></td>
                    <td>
                        <select class="mr10">
                            <option>대표관리자</option>
                            <option>게시판관리자</option>
                            <option>수입관리자</option>
                        </select>
                    </td>
                    <td>test111@gmail.com</td>
                    <td>관리자</td>
                    <td>김지영</td>
                    <td>010-0000-0000</td>
                    <td>2020-09-09</td>
                    <td>
                        <button class="comm-btn admin-btn">수정</button>
                        <button class="comm-btn admin-btn">삭제</button>
                    </td>
                </tr>-->
                </tbody>
            </table>
        </div>

        <div class="inventList page-tableBox pc768-wrap wait-list">
            <div class="wait-list-2">
                <p>등급별 관리 설정</p>
                <div class="search-wrap-admin">
                    <button id="modify-grade" class="comm-btn">저장</button>
                    <button id="delete-grade" class="comm-btn">등급 삭제</button>
                    <button id="add-grade" class="yellow-btn">등급 추가</button>
                </div>
            </div>

            <table class="page-table1 table-hover adminList-table">
                <colgroup>
                    <col style="width:5%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                    <col style="width:*%">
                </colgroup>

                <thead>
                <tr>
                    <th><input type="checkbox" id="chkAllKinds"></th>
                    <th>등급</th>
                    <th>회원리스트</th>
                    <th>가입대기 리스트</th>
                    <th>회비입금 확인</th>
                    <th>투자관리</th>
                    <th>수익관리</th>
                    <th>팝업 관리</th>
                    <th>게시판 관리</th>
                </tr>
                </thead>
                <tbody id="managerKindsTbody">
                <tr>
                    <td><input type="checkbox"></td>
                    <td>
                        <input type="text" class="adminList-class w100" placeholder="등급명 입력">
                    </td>
                    <td>
                        <select class="mr10">
                            <option>관리 안함</option>
                            <option>관리</option>
                        </select>
                    </td>
                    <td>
                        <select class="mr10">
                            <option>관리 안함</option>
                            <option>관리</option>
                        </select>
                    </td>
                    <td>
                        <select class="mr10">
                            <option>관리 안함</option>
                            <option>관리</option>
                        </select>
                    </td>
                    <td>
                        <select class="mr10">
                            <option>관리 안함</option>
                            <option>관리</option>
                        </select>
                    </td>
                    <td>
                        <select class="mr10">
                            <option>관리 안함</option>
                            <option>관리</option>
                        </select>
                    </td>
                    <td>
                        <select class="mr10">
                            <option>관리 안함</option>
                            <option>관리</option>
                        </select>
                    </td>
                    <td>
                        <select class="mr10">
                            <option>관리 안함</option>
                            <option>관리</option>
                        </select>
                    </td>
                </tr>
                <!--            <tr>
                                <td><input type="checkbox"></td>
                                <td>
                                    <input type="text" class="adminList-class w100" placeholder="등급별 입력">
                                </td>
                                <td>
                                    <select class="mr10">
                                        <option>관리 안함</option>
                                        <option>관리</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="mr10">
                                        <option>관리 안함</option>
                                        <option>관리</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="mr10">
                                        <option>관리 안함</option>
                                        <option>관리</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="mr10">
                                        <option>관리 안함</option>
                                        <option>관리</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="mr10">
                                        <option>관리 안함</option>
                                        <option>관리</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="mr10">
                                        <option>관리 안함</option>
                                        <option>관리</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="mr10">
                                        <option>관리 안함</option>
                                        <option>관리</option>
                                    </select>
                                </td>
                            </tr>-->
                </tbody>
            </table>
        </div>

        <!-- 모달창 -->
        <div class="invent-modal modal modal-admin-wrap">
            <div class="modal-inner">
                <div class="modal-title">
                    <p class="title">관리자 추가</p>
                    <a href="#" class="close-btn">닫기</a>
                </div>
                <div class="modal-img">
                    <img id="add-img" src="../images/none_userIme.jpg" alt="">
                    <div class="img-btn">
                        <a href="#" id="add-default-btn" class="white-btn">기본이미지로 변경</a>
                        <a href="#" id="add-upload-btn" class="white-btn">이미지 업로드</a>
                        <input id="add-file" class="add-profileImg d-none" type="file" accept=".jpg, .jpeg, .gif, .png"/>
                    </div>
                </div>

                <div class="modal-text">
                    <div class="text">
                        <p class="title">등급</p>
                        <select id="selAddManagerUserKinds"></select>
                    </div>
                    <div class="text">
                        <p class="title">아이디</p>
                        <input type="text" id="addId">
                    </div>
                    <div class="text">
                        <p class="title">비밀번호</p>
                        <input type="password" id="addPW">
                    </div>
                    <div class="text">
                        <p class="title">닉네임</p>
                        <input type="text" id="addNickName">
                    </div>
                    <div class="text">
                        <p class="title">관리자명</p>
                        <input type="text" id="addName">
                    </div>
                    <div class="text">
                        <p class="title">관리자 연락처</p>
                        <input type="text" id="addMobile" placeholder="예) 000-0000-0000">
                    </div>
                </div>
                <div class="modal-btn">
                    <a href="#" id="addManagerCloseBtn" class="white-btn close-btn mr10">닫기</a>
                    <a href="#" class="yellow-btn" id="addManagerBtn">등록</a>
                </div>
            </div>
            <div class="modal-bg"></div>
        </div>

        <div class="invent-modal modal modal-admin-wrap2">
            <div class="modal-inner">
                <div class="modal-title">
                    <p class="title">관리자 상세정보</p>
                    <a class="cupoint close-btn">닫기</a>
                </div>
                <div class="modal-img">
                    <img id="modify-img" src="../images/none_userIme.jpg" alt="">
                    <div class="img-btn">
                        <a href="#" id="modify-default-btn" class="white-btn">기본이미지로 변경</a>
                        <a href="#" id="modify-upload-btn" class="white-btn">이미지 업로드</a>
                        <input id="modify-file" class="add-profileImg d-none" type="file" accept=".jpg, .jpeg, .gif, .png"/>
                    </div>
                </div>

                <div class="modal-text">
                    <div class="text">
                        <p class="title">등급</p>
                        <select id="selModifyManagerKinds"></select>
                    </div>
                    <div class="text">
                        <p class="title">아이디</p>
                        <input type="text" id="modifyId" disabled>
                    </div>
                    <div class="text">
                        <p class="title">비밀번호</p>
                        <input type="password" id="modifyPw">
                    </div>
                    <div class="text">
                        <p class="title">닉네임</p>
                        <input type="text" id="modifyNickName">
                    </div>
                    <div class="text">
                        <p class="title">관리자명</p>
                        <input type="text" id="modifyName">
                    </div>
                    <div class="text">
                        <p class="title">관리자 연락처</p>
                        <input type="text" id="modifyMobile">
                    </div>
                </div>
                <div class="modal-btn">
                    <a class="white-btn close-btn mr10 cupoint">닫기</a>
                    <a class="yellow-btn cupoint" id="modifyManagerBtn">수정</a>
                </div>
            </div>
            <div class="modal-bg"></div>
        </div>


    </div>

    <script src="/js/script.js"></script>
    <script src="/js/admin.js"></script>
    <script src="/js/dev.js"></script>

    <script>
        let saveFile;
        let updateFile;
        let userImgUrl;
        let updateManagerUserSeq;
        let defaultImg = false;
        let e = 0;

        getManagerUsers();
        getManagerKinds();


        // 추가 모달
        $('.admin-add-btn').click(function () {
            $('.modal-admin-wrap').css('display', 'block');
            $("#add-img").attr("src", "../images/none_userIme.jpg");
            $(".modal-admin-wrap").find('input').each(function() {
                $(this).val(null);
            });
            saveFile=undefined;
            getManagerKinds3();
        });

        // 관리자 등급(분류) 불러오기 (테이블용)
        function getManagerKinds() {
            $.ajax({
                type: "get",
                url: "/api/admin/members/managers/kinds",
                async: false,
                success: function (data) {
                    let list = data;

                    let kindsTag = '';
                    if(list.length != 0) {
                        for(i=0; i<list.length; i++) {
                            let arrAccess = new Array();
                            if(list[i].abilities!=null && list[i].abilities.length!=0) {
                                arrAccess = list[i].abilities;
                            }
                            kindsTag += '<tr>';
                            kindsTag += '<td><input type="checkbox" class="chkKinds" seq="'+list[i].seq+'"></td>';
                            kindsTag += '<td>';
                            kindsTag += '<input type="text" class="adminList-class w100 gradeName" placeholder="등급명 입력" value="'+list[i].name+'">';
                            kindsTag += '</td>';

                            // 회원리스트 select
                            kindsTag += '<td>';
                            kindsTag += '<select class="mr10 selPermission" seq="mgpm_0000000002">';// seq = 회원리스트 경로 시퀀스
                            if(arrAccess.includes("mgpm_0000000002")) {
                                kindsTag += '<option value="false">관리 안함</option>';
                                kindsTag += '<option value="true" selected>관리</option>';
                            }else {
                                kindsTag += '<option value="false" selected>관리 안함</option>';
                                kindsTag += '<option value="true">관리</option>';
                            }
                            kindsTag += '</select>';
                            kindsTag += '</td>';

                            // 가입대기 리스트 select
                            kindsTag += '<td>';
                            kindsTag += '<select class="mr10 selPermission" seq="mgpm_0000000003">';// seq = 가입대기 경로 시퀀스
                            if(arrAccess.includes("mgpm_0000000003")) {
                                kindsTag += '<option value="false">관리 안함</option>';
                                kindsTag += '<option value="true" selected>관리</option>';
                            }else {
                                kindsTag += '<option value="false" selected>관리 안함</option>';
                                kindsTag += '<option value="true">관리</option>';
                            }
                            kindsTag += '</select>';
                            kindsTag += '</td>';

                            // 회비입금 확인 select
                            kindsTag += '<td>';
                            kindsTag += '<select class="mr10 selPermission" seq="mgpm_0000000004,mgpm_0000000005">';// seq = 회비입금 경로 시퀀스
                            if(arrAccess.includes("mgpm_0000000004")) {
                                kindsTag += '<option value="false">관리 안함</option>';
                                kindsTag += '<option value="true" selected>관리</option>';
                            }else {
                                kindsTag += '<option value="false" selected>관리 안함</option>';
                                kindsTag += '<option value="true">관리</option>';
                            }
                            kindsTag += '</select>';
                            kindsTag += '</td>';

                            // 투자관리 select
                            kindsTag += '<td>';
                            kindsTag += '<select class="mr10 selPermission" seq="mgpm_0000000006">';// seq = 투자관리 경로 시퀀스
                            if(arrAccess.includes("mgpm_0000000006")) {
                                kindsTag += '<option value="false">관리 안함</option>';
                                kindsTag += '<option value="true" selected>관리</option>';
                            }else {
                                kindsTag += '<option value="false" selected>관리 안함</option>';
                                kindsTag += '<option value="true">관리</option>';
                            }
                            kindsTag += '</select>';
                            kindsTag += '</td>';

                            // 수익관리 select
                            kindsTag += '<td>';
                            kindsTag += '<select class="mr10 selPermission" seq="mgpm_0000000007,mgpm_0000000008,mgpm_0000000009">';// seq = 수익관리 경로 시퀀스
                            if(arrAccess.includes("mgpm_0000000007")) {
                                kindsTag += '<option value="false">관리 안함</option>';
                                kindsTag += '<option value="true" selected>관리</option>';
                            }else {
                                kindsTag += '<option value="false" selected>관리 안함</option>';
                                kindsTag += '<option value="true">관리</option>';
                            }
                            kindsTag += '</select>';
                            kindsTag += '</td>';

                            // 팝업관리 select
                            kindsTag += '<td>';
                            kindsTag += '<select class="mr10 selPermission" seq="mgpm_0000000013,mgpm_0000000014,mgpm_0000000015">';// seq = 팝업관리 경로 시퀀스
                            if(arrAccess.includes("mgpm_0000000012")) {
                                kindsTag += '<option value="false">관리 안함</option>';
                                kindsTag += '<option value="true" selected>관리</option>';
                            }else {
                                kindsTag += '<option value="false" selected>관리 안함</option>';
                                kindsTag += '<option value="true">관리</option>';
                            }
                            kindsTag += '</select>';
                            kindsTag += '</td>';

                            // 게시판 관리 select
                            kindsTag += '<td>';
                            kindsTag += '<select class="mr10 selPermission" seq="mgpm_0000000016,mgpm_0000000017,mgpm_0000000018,mgpm_0000000019,mgpm_0000000020,mgpm_0000000021,mgpm_0000000022,mgpm_0000000023">';// seq = 게시판 관리 경로 시퀀스
                            if(arrAccess.includes("mgpm_0000000015")) {
                                kindsTag += '<option value="false">관리 안함</option>';
                                kindsTag += '<option value="true" selected>관리</option>';
                            }else {
                                kindsTag += '<option value="false" selected>관리 안함</option>';
                                kindsTag += '<option value="true">관리</option>';
                            }
                            kindsTag += '</select>';
                            kindsTag += '</td>';

                            kindsTag += '</tr>';
                        }
                        $("#managerKindsTbody").html(kindsTag);
                    }

                },
                error: function (error) {
                    console.log(error.toString());
                }
            });
        }

        // 관리자 등급(분류) 불러오기 (관리자 리스트용)
        function getManagerKinds2() {
            $.ajax({
                type: "get",
                url: "/api/admin/members/managers/kinds",
                data: {},
                async: false,
                success: function (data) {
                    let selTag='<option value="" selected hidden>등급 없음</option>';
                    if(data.length!=0) {
                        for(i=0; i<data.length; i++) {
                            selTag += '<option value="'+data[i].seq+'">'+data[i].name+'</option>';
                        }
                    }
                    $(".selUsers").html(selTag);
                },
                error: function (error) {
                    console.log(error.toString());
                }
            });
        }

        // 관리자 등급(분류) 불러오기 (관리자 추가 모달용)
        function getManagerKinds3() {
            $.ajax({
                type: "get",
                url: "/api/admin/members/managers/kinds",
                data: {},
                success: function (data) {
                    let selTag='';
                    if(data.length!=0) {
                        for(i=0; i<data.length; i++) {
                            selTag += '<option value="'+data[i].seq+'">'+data[i].name+'</option>';
                        }
                    }
                    $("#selAddManagerUserKinds").html(selTag);
                },
                error : function(request, status, error) {
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }

        // 관리자 등급(분류) 불러오기 (관리자 수정 모달용)
        function getManagerKinds4() {
            $.ajax({
                type: "get",
                url: "/api/admin/members/managers/kinds",
                data: {},
                success: function (data) {
                    let selTag='';
                    if(data.length!=0) {
                        for(i=0; i<data.length; i++) {
                            selTag += '<option value="'+data[i].seq+'">'+data[i].name+'</option>';
                        }
                    }
                    $("#selModifyManagerKinds").html(selTag);
                },
                error : function(request, status, error) {
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }

        // 관리자 등급(분류) 추가
        $("#add-grade").on("click", function() {
            let trNum = $("#managerKindsTbody tr").length;
            let name = "관리자"+(trNum+1);
            $.ajax({
                type:"post",
                url:"/api/admin/members/managers/kinds",
                contentType: "application/json",
                data: JSON.stringify({
                    "name" : name
                }),
                success:function(data) {
                    getManagerKinds();
                    getManagerUsers();
                },
                error : function(request, status, error) {
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });

        });

        // 관리자 등급(분류) 수정(저장)
        $("#modify-grade").on("click", function() {
            let checkedNum = $(".chkKinds:checked").length;
            if(checkedNum==0) {
                toastModal("내용을 변경하려는 등급을 선택해주세요");
                return;
            }
            e=0;
            $("#managerKindsTbody .chkKinds:checked").each(function(){
                let tr = $(this).parent().parent();
                let seq= $(this).attr("seq");
                let name = tr.find(".gradeName").val();
                if(name=="대표관리자") {
                    toastModal("'대표관리자'는 사용할 수 없는 이름입니다.");
                    return;
                }
                let abilities = [];
                tr.find(".selPermission").each(function(){
                    let permission = $(this).val();
                    if(permission=="true") {
                        let arrUrl = $(this).attr("seq").split(",");
                        arrUrl.forEach(function (arguments){
                            abilities.push(arguments);
                        });
                    }
                });
                let objData = {
                    "name" : name,
                    "abilities" : abilities
                };
                updateManagerKinds(objData, seq);
                // alert(e);
                if(e==2) {
                    return false;
                }
            });
            if(e==1) {
                $("#chkAllKinds").prop("checked", false);
                getManagerKinds();
                getManagerUsers();
            }
            location.reload();
        });

        // 관리자 등급 변경 function
        function updateManagerKinds(objData, seq){
            $.ajax({
                type:"put",
                url:"/api/admin/members/managers/kinds/"+seq,
                contentType: "application/json",
                data: JSON.stringify(objData),
                async:false,
                success:function(data) {
                    e=1;
                },
                error : function(request, status, error) {
                    toastModal("등급 정보 변경에 실패했습니다.");
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                    e=2;
                }
            });
        };

        // 관리자 등급(분류) 삭제
        $("#delete-grade").on("click", function() {
            let checkedNum = $(".chkKinds:checked").length;
            if(checkedNum==0) {
                toastModal("삭제하려는 등급을 선택해주세요");
                return;
            }

            $("#managerKindsTbody .chkKinds:checked").each(function(){
                let seq = $(this).attr("seq");
                $.ajax({
                    type:"delete",
                    url:"/api/admin/members/managers/kinds/"+seq,
                    success:function(data) {

                    },
                    error : function(request, status, error) {
                        toastModal("등급 정보 삭제에 실패했습니다.");
                        console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                        return;
                    }
                });
            });
            location.reload();
        });

        // 관리자 회원 목록 불러오기
        function getManagerUsers() {
            $.ajax({
                type: "get",
                url: "/api/admin/members/managers",
                data: {},
                async: false,
                success: function (data) {
                    let managerUsersTag = '';
                    let arrKindsSeq = [];
                    if (data.length != 0) {
                        for (i = 0; i < data.length; i++) {
                            arrKindsSeq.push(data[i].managerKindsSeq);
                            managerUsersTag += '<tr seq="'+data[i].managerUserSeq+'">' +
                                '<td><input type="checkbox" class="chkUsers"></td>' +
                                '<td>' +
                                '<select class="mr10 selUsers" id="sel'+i+'">' +
                                '</select>' +
                                '</td>' +
                                '<td>'+data[i].id+'</td>' +
                                '<td>'+data[i].nickName+'</td>' +
                                '<td>'+data[i].name+'</td>' +
                                '<td>'+data[i].mobile+'</td>' +
                                '<td>'+data[i].createdAt+'</td>' +
                                '<td class="y-admin-btn-wrap">' +
                                '<button class="comm-btn admin-btn admin-modify-btn">수정</button>' +
                                '<button class="comm-btn admin-btn admin-delete-btn">삭제</button>' +
                                '</td>' +
                                '</tr>';
                        }
                        $("#managerUsersTbody").html(managerUsersTag);
                        getManagerKinds2();
                        $(".selUsers").each(function(index) {
                            $(this).val(arrKindsSeq[index]).prop('selected', true);
                        });
                    }else {
                        $("#managerUsersTbody").html(managerUsersTag);
                    }

                    // 수정 모달
                    $('.admin-modify-btn').click(function () {
                        $('.modal-admin-wrap2').css('display', 'block');
                        getManagerKinds4()
                        let managerUserSeq = $(this).parent().parent().attr("seq");
                        getManagerUserDetails(managerUserSeq);
                    });

                    // 관리자 삭제
                    $(".admin-delete-btn").on("click", function(){
                        let managerUserSeq = $(this).parent().parent().attr("seq");
                        if(!confirm("관리자를 삭제하시겠습니까?\n※ 삭제한 관리자는 로그인을 할 수 없습니다.")) {
                            return;
                        }
                        managerUserDelete(managerUserSeq);
                    });

                    // 관리자 등급만 수정
                    $(".selUsers").on("change", function(){
                        let managerUserSeq = $(this).parent().parent().attr("seq");
                        let managerKindsSeq = $(this).val();
                        updateManagerUserGrade(managerUserSeq, managerKindsSeq);
                    });
                },
                error : function(request, status, error) {
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }

        // 체크박스 function
        $("#chkAllKinds").on("click", function(){
            let chkNum=$(".chkKinds").length;
            let checkedNum=$(".chkKinds:checked").length;

            if(chkNum!=checkedNum) {
                $(".chkKinds").each(function(){
                    $(this).prop("checked", true);
                });
            }else {
                $(".chkKinds").each(function(){
                    $(this).prop("checked", false);
                });
            }
        });

        $("#managerKindsTbody").on("click", ".chkKinds", function() {
            let chkNum=$(".chkKinds").length;
            let checkedNum=$(".chkKinds:checked").length;

            if(chkNum==checkedNum){
                $("#chkAllKinds").prop("checked", true);
            }else{
                $("#chkAllKinds").prop("checked", false);
            }
        });

        $("#chkAllUsers").on("click", function(){
            let chkNum=$(".chkUsers").length;
            let checkedNum=$(".chkUsers:checked").length;

            if(chkNum!=checkedNum) {
                $(".chkUsers").each(function(){
                    $(this).prop("checked", true);
                });
            }else {
                $(".chkUsers").each(function(){
                    $(this).prop("checked", false);
                });
            }
        });

        $("#managerUsersTbody").on("click", ".chkUsers", function() {
            let chkNum=$(".chkUsers").length;
            let checkedNum=$(".chkUsers:checked").length;

            if(chkNum==checkedNum){
                $("#chkAllUsers").prop("checked", true);
            }else{
                $("#chkAllUsers").prop("checked", false);
            }
        });

        // 모달 창 이미지 업로드 (관리자 추가)
        $("#add-upload-btn").on("click", function(e){
            e.preventDefault();
            $("#add-file").click();
        });

        // 이미지 미리보기 (관리자 추가)
        $("#add-file").on("change", function() {
            saveFile = $("#add-file")[0].files[0];
            if(saveFile!=null && saveFile!=undefined) {
                let url=URL.createObjectURL(saveFile);
                $("#add-img").attr("src", url);
            }else {
                $("#add-img").attr("src", "../images/none_userIme.jpg");
            }
        });

        // 기본이미지로 변경 (관리자 추가)
        $("#add-default-btn").on("click", function() {
            saveFile = undefined;
            $("#add-img").attr("src", "../images/none_userIme.jpg");
        });

        // 관리자 추가
        $("#addManagerBtn").on("click", function() {
            let formData= new FormData;
            let managerKindsSeq = $("#selAddManagerUserKinds").val();

            let id = $("#addId").val();
            let password = $("#addPW").val();
            let nickName = $("#addNickName").val();
            let name = $("#addName").val();
            let mobile = $("#addMobile").val();

            if(managerKindsSeq==null || managerKindsSeq=="") {
                toastModal("등급을 선택하세요");
                return;
            }
            if(id==null || id=="") {
                toastModal("아이디를 입력하세요");
                return;
            }
            if(password==null || password=="") {
                toastModal("비밀번호를 입력하세요");
                return;
            }
            if(nickName==null || nickName=="") {
                toastModal("닉네임을 입력하세요");
                return;
            }
            if(name==null || name=="") {
                toastModal("관리자명을 입력하세요");
                return;
            }
            if(mobile==null || mobile=="") {
                toastModal("관리자 연락처를 입력하세요");
                return;
            }

            formData.append("id", id);
            formData.append("password", password);
            formData.append("name", name);
            formData.append("nickName", nickName);
            formData.append("mobile", mobile);
            formData.append("managerKindsSeq", managerKindsSeq);

            if(saveFile!=null && saveFile!=undefined) {
                formData.append("profilePicture", saveFile);
            }

            $.ajax({
                type:"post",
                url:"/api/admin/members/managers",
                data: formData,
                processData: false,
                contentType: false,
                success:function () {
                    toastModal("관리자를 추가했습니다.");
                    setTimeout(() => location.reload(), 1000);
                },
                error : function(request, status, error) {
                    toastModal("관리자 추가에 실패했습니다.");
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        });

        // 관리자 상세
        function getManagerUserDetails(managerUserSeq) {
            $.ajax({
                type:"get",
                url:"/api/admin/members/managers/"+managerUserSeq,
                data: {},
                success:function(data) {
                    updateManagerUserSeq = data.managerUserSeq;
                    $("#selModifyManagerKinds").val(data.managerKindsSeq);
                    $("#modifyId").val(data.id);
                    $("#modifyNickName").val(data.nickName);
                    $("#modifyName").val(data.name);
                    $("#modifyMobile").val(data.mobile);

                    if(data.imgUrl!=null && data.imgUrl!="") {
                        userImgUrl=data.imgUrl;
                        $("#modify-img").attr("src", data.imgUrl);
                    }else {
                        userImgUrl=null;
                        $("#modify-img").attr("src", "../images/none_userIme.jpg");
                    }
                },
                error : function(request, status, error) {
                    toastModal("관리자 정보를 불러오는데 실패했습니다.");
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }

        // 모달 창 이미지 업로드 (관리자 수정)
        $("#modify-upload-btn").on("click", function(e){
            e.preventDefault();
            $("#modify-file").click();
        });

        // 이미지 미리보기 (관리자 추가)
        $("#modify-file").on("change", function() {
            updateFile = $("#modify-file")[0].files[0];
            if(updateFile!=null && updateFile!=undefined) {
                let url=URL.createObjectURL(updateFile);
                $("#modify-img").attr("src", url);
            }else {
                if(userImgUrl!=null && userImgUrl!="") {
                    $("#modify-img").attr("src", userImgUrl);
                }else{
                    $("#modify-img").attr("src", "../images/none_userIme.jpg");
                }
            }
            defaultImg=false;
        });

        // 기본이미지로 변경 (관리자 추가)
        $("#modify-default-btn").on("click", function() {
            updateFile = undefined;
            $("#modify-img").attr("src", "../images/none_userIme.jpg");
            defaultImg=true;
        });

        // 관리자 수정
        $("#modifyManagerBtn").on("click", function() {
            let formData= new FormData;
            let managerKindsSeq = $("#selModifyManagerKinds").val();

            let id = $("#modifyId").val();
            let password = $("#modifyPw").val();
            let nickName = $("#modifyNickName").val();
            let name = $("#modifyName").val();
            let mobile = $("#modifyMobile").val();

            if(managerKindsSeq==null || managerKindsSeq=="") {
                toastModal("등급을 선택하세요");
                return;
            }
            if(id==null || id=="") {
                toastModal("아이디를 입력하세요");
                return;
            }
            if(nickName==null || nickName=="") {
                toastModal("닉네임을 입력하세요");
                return;
            }
            if(name==null || name=="") {
                toastModal("관리자명을 입력하세요");
                return;
            }
            if(mobile==null || mobile=="") {
                toastModal("관리자 연락처를 입력하세요");
                return;
            }

            formData.append("id", id);
            formData.append("password", password);
            formData.append("name", name);
            formData.append("nickName", nickName);
            formData.append("mobile", mobile);
            formData.append("managerKindsSeq", managerKindsSeq);

            if(updateFile!=null && updateFile!=undefined) {
                formData.append("profilePicture", updateFile);
            }

            formData.append("defaultImg", defaultImg);

            $.ajax({
                type:"put",
                url:"/api/admin/members/managers/"+updateManagerUserSeq,
                data: formData,
                processData: false,
                contentType: false,
                success:function () {
                    toastModal("관리자 정보를 수정했습니다.");
                    setTimeout(() => location.reload(), 1000);
                },
                error : function(request, status, error) {
                    toastModal("관리자 정보 수정에 실패했습니다.");
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        });


        // 관리자 삭제 function
        function managerUserDelete(managerUserSeq) {
            $.ajax({
                type:"delete",
                url:"/api/admin/members/managers/"+managerUserSeq,
                data:{},
                success:function () {
                    toastModal("관리자를 삭제했습니다.");
                    getManagerUsers()
                },
                error : function(request, status, error) {
                    toastModal("관리자 삭제에 실패했습니다.");
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }

        // 관리자 회원 등급만 수정 function
        function updateManagerUserGrade(managerUserSeq, managerKindsSeq) {
            $.ajax({
                type:"put",
                url:"/api/admin/members/managers/"+managerUserSeq+"/grade",
                data:{"managerKindsSeq":managerKindsSeq},
                success:function () {
                    toastModal("관리자 등급이 변경되었습니다.");
                    setTimeout(() => getManagerUsers(), 1000);
                },
                error : function(request, status, error) {
                    toastModal("관리자 등급 변경에 실패했습니다.");
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }
    </script>
</div>
</html>
